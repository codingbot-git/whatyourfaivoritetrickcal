<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>당신의 최애 사도 뽑기</title>

<style>
body, html {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    background: #000;
    overflow: hidden;
    font-family: 'Apple SD Gothic Neo','Malgun Gothic',sans-serif;
}

.bg-image {
    background-image: url('background/startingimage.jpg');
    background-size: cover;
    background-position: center;
    width: 100%; height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.quiz-container {
    background: rgba(0,0,0,0.8);
    padding: 30px 20px;
    border-radius: 20px;
    width: 85%;
    max-width: 450px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    color: #fff;
    box-shadow: 0 10px 40px rgba(0,0,0,0.7);
}

h2 {
    font-size: 1.1rem;
    margin-bottom: 20px;
    flex-shrink: 0;
}

.options {
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow-y: auto;
}

.option-btn {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 12px;
    padding: 14px;
    color: #fff;
    font-size: 0.85rem;
    cursor: pointer;
    text-align: left;
    transition: 0.2s;
}

.option-btn:hover {
    background: rgba(255,255,255,0.2);
    border-color: #fff;
}

#result-screen {
    display: none;
    align-items: center;
    justify-content: center;
}

.result-image {
    width: 200px;
    border-radius: 15px;
    margin-bottom: 20px;
}

.result-text {
    font-size: 1.6rem;
    font-weight: bold;
    color: #ffd700;
    margin-bottom: 20px;
}

.retry-btn {
    border: none;
    padding: 12px 30px;
    border-radius: 50px;
    font-weight: bold;
    cursor: pointer;
}
</style>
</head>

<body>
<div class="bg-image">

<div id="quiz-screen" class="quiz-container">
    <h2 id="question-text"></h2>
    <div id="options-container" class="options"></div>
</div>

<div id="result-screen" class="quiz-container">
    <div id="final-area" style="text-align:center;"></div>
    <button class="retry-btn" onclick="location.reload()">다시 하기</button>
</div>

</div>

<script>
/* ================= 공통 유틸 ================= */

function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function renderQuestion(question, callback) {
    document.getElementById("question-text").innerText = question.q;
    const container = document.getElementById("options-container");
    container.innerHTML = "";

    shuffle([...question.options]).forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.innerText = opt.text;
        btn.onclick = () => callback(opt.value);
        container.appendChild(btn);
    });
}

/* ================= 데이터 ================= */

// 1단계 성격
const personalityQuestions = [
{
    q: "에르핀이 교단 예산을 전부 간식으로 바꿨다!",
    options: [
        { text: "꿀밤부터 간다", value: "광기" },
        { text: "반성문부터", value: "냉정" },
        { text: "다음엔 그러지 말자", value: "순수" },
        { text: "행복하면 됐다", value: "활발" },
        { text: "내가 대신 혼날게", value: "우울" }
    ]
},
{
    q: "마리가 왕국을 또 터뜨렸다!",
    options: [
        { text: "더 크게 터뜨려준다", value: "광기" },
        { text: "복구 끝날 때까지 노동", value: "냉정" },
        { text: "다음부턴 밖에서", value: "순수" },
        { text: "소리 시원했다", value: "활발" },
        { text: "난 범인 아니다", value: "우울" }
    ]
}
];

// 2단계 종족
const raceQuestion = {
q: "당신과 동행할 사도는?",
options: [
    { text: "친화력 좋은 무리 사도", value: "수인" },
    { text: "마법과 세계수", value: "요정" },
    { text: "가장 현대적인 사도", value: "엘프" },
    { text: "한 가지에 집착", value: "용족" },
    { text: "현명한 박식가", value: "마녀" },
    { text: "장난꾸러기", value: "유령" },
    { text: "별게 다 있다", value: "정령" },
    { text: "정체불명", value: "미스틱" }
]
};

// 3단계 위치
function getPositionQuestion() {
    let opts = [
        { text: "전열", value: "전열" },
        { text: "중열", value: "중열" },
        { text: "후열", value: "후열" }
    ];

    if (
        (selectedPersonality === "우울" && selectedRace === "요정") ||
        (selectedPersonality === "광기" && selectedRace === "수인")
    ) {
        opts.push({ text: "모든 열", value: "모든 열" });
    }

    return { q: "어디에서 사도를 지키겠습니까?", options: opts };
}

// 4단계 물리/마법
const methodQuestions = [
{
    q: "비비가 따잇 당하고 있다!",
    options: [
        { text: "들고 튄다", value: "물리" },
        { text: "더 세게 친다", value: "물리" },
        { text: "앞에서 메친다", value: "물리" },
        { text: "시간 정지", value: "마법" },
        { text: "폭발 마법", value: "마법" },
        { text: "보호막", value: "마법" }
    ]
},
{
    q: "마리가 천장에 끼었다!",
    options: [
        { text: "부수고 꺼낸다", value: "물리" },
        { text: "잡아당긴다", value: "물리" },
        { text: "직접 밀어낸다", value: "물리" },
        { text: "부유 마법", value: "마법" },
        { text: "공간 왜곡", value: "마법" },
        { text: "염력", value: "마법" }
    ]
}
];

/* ================= 상태 ================= */

let selectedPersonality = "";
let selectedRace = "";
let selectedPos = "";
let methodScore = { 물리: 0, 마법: 0 };
let methodIdx = 0;

/* ================= 흐름 ================= */

function startQuiz() {
    const q = personalityQuestions[Math.floor(Math.random() * personalityQuestions.length)];
    renderQuestion(q, val => {
        selectedPersonality = val;
        loadRace();
    });
}

function loadRace() {
    let opts = raceQuestion.options.filter(o =>
        selectedPersonality === "우울" ? true : o.value !== "미스틱"
    );

    renderQuestion({ q: raceQuestion.q, options: opts }, val => {
        selectedRace = val;
        if (val === "미스틱") showResult();
        else loadPosition();
    });
}

function loadPosition() {
    renderQuestion(getPositionQuestion(), val => {
        selectedPos = val;
        loadMethod();
    });
}

function loadMethod() {
    renderQuestion(methodQuestions[methodIdx], val => {
        methodScore[val]++;
        methodIdx++;
        methodIdx < methodQuestions.length ? loadMethod() : showResult();
    });
}

function showResult() {
    document.getElementById("quiz-screen").style.display = "none";
    document.getElementById("result-screen").style.display = "flex";

    let name = selectedRace;
    let img = "";

    if (selectedRace === "미스틱") {
        name = "요미";
        img = "apostle/요미.webp";
    }
    if (selectedRace === "요정" && selectedPos === "모든 열") {
        name = "죠안";
        img = "apostle/죠안.png";
    }
    if (selectedRace === "수인" && selectedPos === "모든 열") {
        name = "티그(영웅)";
        img = "apostle/티그 영웅.webp";
    }

    document.getElementById("final-area").innerHTML = `
        ${img ? `<img src="${img}" class="result-image">` : ""}
        <div class="result-text">당신의 사도 : ${name}</div>
        <div style="color:#aaa;">성향: ${methodScore.물리 >= methodScore.마법 ? "물리" : "마법"}</div>
    `;
}

window.onload = startQuiz;
</script>
</body>
</html>
